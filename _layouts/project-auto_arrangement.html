<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<body id="page-top">
  {% include nav_sub.html %}
  <section class="bg-warning" id="">
      <div class="container no-gutter">
        <div class="row"><p class="h1"></p></div>
        <div class="row"><p class="h1"></p></div>
        <div class="row"><p class="h1"></p></div>
        <div class="row"><p class="h1"></p></div>
        <div class="row"><p class="h1"></p></div>
          <div class="row">

            <div class="col-lg-12 text-center">
              <h2 class="section-heading">Algorithm Arrangement via Search and Style Transfer</h2> 
              <a href="https://github.com/zhaojw1998/Accompaniment-Generation-via-Music-Representation-Learning">
                <i class="fa fa-github fa-3x wow bounceIn" data-wow-delay=".1s"></i>
              </a>
              <hr class="primary">
            </div>

            <p class="h3">Motivation</p>

            <p class='text-justify'>
              If you ask a professional piano improvisor how he can arrange an accompaniment for a song instantly, he/she may well tell you: <em>"I'm not arranging it myself. I'm just borrowing from Rahmaninov!</em>" In many cases like this, musicians make improvisational accompaniment not from scratch, but by retrieving similar piano pieces they have mastered before, and playing the pieces with proper harmonic modification. Hence we propose, if we acquire a large dataset of music corpora (just as what the improvisor does in his/her brain), and a style transfer model which can finely modify a polyphonic input's harmonic structure, then we can generate high-quality arrangement for any lead melody simply by search and style transfer. This can be further developed to, say, an automatic accompaniment system, which can be applied on line, rendering amazing experience with real-time improvizational accompaniment generation.
            </p>

            <p class="h3">Demos</p>

            <p class='text-justify'>
              At first, please play the following demos to see what we can do. Our proposed framework now can generate accompaniment for <b><em>full-score</em></b> melodies up to several minutes. We present accompaniment generation results for four lead melodies from the Nottingham Dataset, one at each line. In each line, the original melody (with a chord track) is followed by two accompanied versions in different texture style generated by our framework. We render the melody timbre by solo violin and the accompaniment by piano. Please enjoy!
            </p>
            
            <div class="row ">
              <blockquote class="h4 text-left">
                Demo 1: Morning Star
              </blockquote>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/01. Morning Star/Morning Star - Original Melody from Nottingham Dataset.ogg" type="audio/ogg" />
                    <source src="audio/algarr/01. Morning Star/Morning Star - Original Melody from Nottingham Dataset.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/01. Morning Star/Morning Star - Original Melody from Nottingham Dataset.mp3">Lead Melody</a>
                  </audio>
                  <p class="h5">Lead Melody</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/01. Morning Star/Morning Star - Accompaniment Generation Result 1.ogg" type="audio/ogg" />
                    <source src="audio/algarr/01. Morning Star/Morning Star - Accompaniment Generation Result 1.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/01. Morning Star/Morning Star - Accompaniment Generation Result 1.mp3">Accompaniment Result 1</a>
                  </audio>
                  <p class="h5">Accompaniment Result 1</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/01. Morning Star/Morning Star - Accompaniment Generation Result 2.ogg" type="audio/ogg" />
                    <source src="audio/algarr/01. Morning Star/Morning Star - Accompaniment Generation Result 2.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/01. Morning Star/Morning Star - Accompaniment Generation Result 2.mp3">Accompaniment Result 2</a>
                  </audio>
                  <p class="h5">Accompaniment Result 2</p>
                </div>
            </div>

            <div class="row ">
              <blockquote class="h4 text-left">
                Demo 2: The 29th of May
              </blockquote>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/02. The 29th of May/The 29th of May - Original Melody from Nottingham Dataset.ogg" type="audio/ogg" />
                    <source src="audio/algarr/02. The 29th of May/The 29th of May - Original Melody from Nottingham Dataset.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/02. The 29th of May/The 29th of May - Original Melody from Nottingham Dataset.mp3">Lead Melody</a>
                  </audio>
                  <p class="h5">Lead Melody</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/02. The 29th of May/The 29th of May - Accompaniment Generation Result 1.ogg" type="audio/ogg" />
                    <source src="audio/algarr/02. The 29th of May/The 29th of May - Accompaniment Generation Result 1.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/02. The 29th of May/The 29th of May - Accompaniment Generation Result 1.mp3">Accompaniment Result 1</a>
                  </audio>
                  <p class="h5">Accompaniment Result 1</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/02. The 29th of May/The 29th of May - Accompaniment Generation Result 2.ogg" type="audio/ogg" />
                    <source src="audio/algarr/02. The 29th of May/The 29th of May - Accompaniment Generation Result 2.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/02. The 29th of May/The 29th of May - Accompaniment Generation Result 2.mp3">Accompaniment Result 2</a>
                  </audio>
                  <p class="h5">Accompaniment Result 2</p>
                </div>
            </div>

            <div class="row ">
              <blockquote class="h4 text-left">
                Demo 3: Barry's Favourite
              </blockquote>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/03. Barry's Favourite/Barry's Favourite - Original Melody from Nottingham Dataset.ogg" type="audio/ogg" />
                    <source src="audio/algarr/03. Barry's Favourite/Barry's Favourite - Original Melody from Nottingham Dataset.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/03. Barry's Favourite/Barry's Favourite - Original Melody from Nottingham Dataset.mp3">Lead Melody</a>
                  </audio>
                  <p class="h5">Lead Melody</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/03. Barry's Favourite/Barry's Favourite - Accompaniment Generation Result 1.ogg" type="audio/ogg" />
                    <source src="audio/algarr/03. Barry's Favourite/Barry's Favourite - Accompaniment Generation Result 1.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/03. Barry's Favourite/Barry's Favourite - Accompaniment Generation Result 1.mp3">Accompaniment Result 1</a>
                  </audio>
                  <p class="h5">Accompaniment Result 1</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/03. Barry's Favourite/Barry's Favourite - Accompaniment Generation Result 2.ogg" type="audio/ogg" />
                    <source src="audio/algarr/03. Barry's Favourite/Barry's Favourite - Accompaniment Generation Result 2.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/03. Barry's Favourite/Barry's Favourite - Accompaniment Generation Result 2.mp3">Accompaniment Result 2</a>
                  </audio>
                  <p class="h5">Accompaniment Result 2</p>
                </div>
            </div>

            <div class="row ">
              <blockquote class="h4 text-left">
                Demo 4: Boggy Bays
              </blockquote>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/04. Boggy Bays/Boggy Bays - Original Melody from Nottingham Dataset.ogg" type="audio/ogg" />
                    <source src="audio/algarr/04. Boggy Bays/Boggy Bays - Original Melody from Nottingham Dataset.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/04. Boggy Bays/Boggy Bays - Original Melody from Nottingham Dataset.mp3">Lead Melody</a>
                  </audio>
                  <p class="h5">Lead Melody</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/04. Boggy Bays/Boggy Bays - Accompaniment Generation Result 1.ogg" type="audio/ogg" />
                    <source src="audio/algarr/04. Boggy Bays/Boggy Bays - Accompaniment Generation Result 1.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/04. Boggy Bays/Boggy Bays - Accompaniment Generation Result 1.mp3">Accompaniment Result 1</a>
                  </audio>
                  <p class="h5">Accompaniment Result 1</p>
                </div>
                <div class="col-sm-4 text-center">
                  <audio controls>
                    <source src="audio/algarr/04. Boggy Bays/Boggy Bays - Accompaniment Generation Result 2.ogg" type="audio/ogg" />
                    <source src="audio/algarr/04. Boggy Bays/Boggy Bays - Accompaniment Generation Result 2.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/04. Boggy Bays/Boggy Bays - Accompaniment Generation Result 2.mp3">Accompaniment Result 2</a>
                  </audio>
                  <p class="h5">Accompaniment Result 2</p>
                </div>
            </div>


            <p class="h3">Approach</p>

            <p class='text-justify'>
              As previously mentioned, we need a large dataset of music corpora and a style transfer model. We exploit the <a href="https://arxiv.org/abs/2008.07142"><em>POP-909 Dataset</em></a> for our work. POP-909 contains multiple versions of piano arrangements of 909 popular songs created by professional musicians. We process each song to acquire a library of melody-accompaniment pairs, which well aids our purpose for melody-accompaniment matching (more details later). We additionally utilize the phrase tags and segment each song into complete phrases. This helps maintain better rhythmic structure for our arrangement results.
            </p>
              
            <p class='text-justify'>
              We further extend the use of <a href="https://arxiv.org/abs/2008.07122" ><em>Poly-Disentanglement-VAE</em></a> to conduct harmonic modification. For a piece of polyphonic arrangement, we believe its chord progression and texture are two style attributes that can be abstracted, disentangled, and exchanged. Poly-Disentanglement VAE is right for this purpose. Harmonic modification is essentially to substitute the chord attribute of the search result with that of the lead melody. We apply Poly-Disentanglement to realize this kind of style trasfer in the latent space.
            </p>
              
            <p class='text-justify'>
              The overall scheme of our work is shown in the following figure. Poly-Disentanglement VAE is powerful, but we can not rely solely on it because we must also control the rhthmic structure. Therefore we devise and test a series of rule-based criteria to make sure the searched accompaniment candidates are ideal. The search strategy will be discusssed in the following.
            </p>

            <div class="row text-center">
              <img src="img/portfolio/autoarr/diagram.png" style="width: 800px; height: auto ">
              <p></p>
              <p class="h5">Overall Scheme of Algorithm Arrangement</p>
            </div>

            <p class="h3">Search Strategy</p>

            <p class='text-justify'>
              For a melody query <em>Q<sub>M</sub></em>, instead of searching for accompaniment targets directly, we first search for the melody target <em>T<sub>M</sub></em> which is most "similar" to <em>Q<sub>M</sub></em> from POP-909. Our intuition is that, if <em>T<sub>M</sub></em> and <em>Q<sub>M</sub></em> are similar in structures (i.e., progression of chord function, rhythm pattern, etc.), then <em>T<sub>M</sub></em>'s accompaniment will fit <em>Q<sub>M</sub></em> in rhythmic structure as well. Thanks to POP-909 which neatly aligns melody and accompaniment tracks in consistent order. When we have <em>T<sub>M</sub></em>, we retrieve its accompaniment counterpart <em>T<sub>A</sub></em> and manipulate <em>T<sub>A</sub></em>'s chord in the latent space for style transfer. 
            </p>

            <p class='text-justify'>
            With both rule-based search strategy for locating proper candidate <em>T<sub>A</sub></em>, and style transfer for harmonic manipulation, we can generate surprisingly natural and pleasing accompaniment for melody pieces up to several minitues long. To fascilitate our framework for more general scenarios, we will look into search methodologies by ancestral sampling in the latent space conditioned on given melodies for the next stage of this project.
            </p>

            <p class="h3">Ablation Study</p>
            
            <p class='text-justify'>
              Our framework is based on the rule-base search strategy and style transfer. In this section do an ablation study on each of these two components to demonstrate our method's novelty and efficiency。 Here we arrange accompaniment for the song Boggy Bays from the Nottingham Dataset (the 4th song in the last demo section). We cut off the repeated phrases to make our demonstration more concise.
            </p>
            
            
            <p class="h4 text-center">Search Strategy without Style Transfer</p>
            
            <p class='text-justify'>
            If we rely solely on the Rule-Based Search Strategy, the search targets are unlikely to perfectly match the melody in harmony. The longer the melody is, the more complexity its chord progressions can be. Truncating the search length, e.g., to 2 bars can partly relieve the problem, since it is easier to find similar 2-bars chord progressions. However, it will introduce unacceptable structure inconsistency in the longer range. The following demos are arranged by concatenating 2-bar pieces each searched from the dataset without any further manipulation. The result sounds okay within each piece, but not so on the whole range. We present the accompaniment result on the left and the direct search reference on the right.
            </p>

                <div class="col-sm-6 text-center">
                  <audio controls>
                    <source src="audio/algarr/ablation/baseline_bar.ogg" type="audio/ogg" />
                    <source src="audio/algarr/ablation/baseline_bar.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/ablation/baseline_bar.mp3">arr_bar-level</a>
                  </audio>
                  <p class="h5">Accompaniment Result (Baseline 1)</p>
                </div>

                <div class="col-sm-6 text-center">
                  <audio controls>
                    <source src="audio/algarr/ablation/baseline_bar_ref.ogg" type="audio/ogg" />
                    <source src="audio/algarr/ablation/baseline_bar_ref.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/ablation/baseline_bar_ref.mp3">target_bar-level</a>
                  </audio>
                  <p class="h5">Search Reference (Concatenation of 2-Bar Pieces)</p>
                </div>

            <div class="row"><p class="h1"></p></div>
            <p class="h4 text-center">Style Transfer without Search Strategy</p>

            <p class='text-justify'>
              Style transfer can not settle everything on its own either. On the one hand, if accompaniment target <em>T<sub>A</sub></em>'s original chord varies too much from the lead chord, the manipulated results could be unsatisfactory. In fact the harmony is somewhat "colapsed" in this case and sounds rather insipid. On the other hand, the texture of <em>T<sub>A</sub></em> can be totally unmatched with the melody's rhythm. The following demo illustrates both two cases. Its first half is an insipid result, and second an unmatched one.
            </p>       

                <div class="col-sm-6 text-center">
                  <audio controls>
                    <source src="audio/algarr/ablation/baseline_random.ogg" type="audio/ogg" />
                    <source src="audio/algarr/ablation/baseline_random.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/ablation/baseline_random.mp3">arr_phrase_random_search</a>
                  </audio>
                  <p class="h5">Accompaniment Result (Baseline 2)</p>
                </div>
    
                <div class="col-sm-6 text-center">
                  <audio controls>
                    <source src="audio/algarr/ablation/baseline_random_ref.ogg" type="audio/ogg" />
                    <source src="audio/algarr/ablation/baseline_random_ref.mp3" type="audio/mpeg" />
                    <a href="audio/algarr/ablation/baseline_random_ref.mp3">target_phrase_random_search</a>
                  </audio>
                  <p class="h5">Search Reference</p>
                </div>

              <div class="row"><p class="h1"></p></div>
              <p class="h4 text-center">Search AND Style Transfer</p>
              
              <p class='text-justify'>
                The following demo is generated by our complete framework. The accompaniment target is first searched by the ranking of the rule-based criterion, and then style-transfered with lead target chord in the latent space. You will find the arrangement fits the melody well both in harmonic and rhythmic structure. Please enjoy!
              </p>

                  <div class="col-sm-6 text-center">
                    <audio controls>
                      <source src="audio/algarr/ablation/new_1.ogg" type="audio/ogg" />
                      <source src="audio/algarr/ablation/new_1.mp3" type="audio/mpeg" />
                      <a href="audio/algarr/ablation/new_1.mp3">arr1_phrase_rule-based_search</a>
                    </audio>
                    <p class="h5">Accompaniment Result 1 (Proposed Framework)</p>
                  </div>
      
                  <div class="col-sm-6 text-center">
                    <audio controls>
                      <source src="audio/algarr/ablation/new_1_ref.ogg" type="audio/ogg" />
                      <source src="audio/algarr/ablation/new_1_ref.mp3" type="audio/mpeg" />
                      <a href="audio/algarr/ablation/new_1_ref.mp3">target1_phrase_rule-based_search</a>
                    </audio>
                    <p class="h5">Search Reference</p>
                  </div>

                <p class='text-justify'>
                  Below is another demo derived from our arrangement framework on the same song. It sounds natural and pleasing, with a totally different style from the first piece. This illustrates our framework's ability to generate style-varying arrangements.
                </p>                

                  <div class="col-sm-6 text-center">
                    <audio controls>
                      <source src="audio/algarr/ablation/new_2.ogg" type="audio/ogg" />
                      <source src="audio/algarr/ablation/new_2.mp3" type="audio/mpeg" />
                      <a href="audio/algarr/ablation/new_2.mp3">arr2_phrase_rule-based_search</a>
                    </audio>
                    <p class="h5">Accompaniment Result 2 (Proposed Framework)</p>
                  </div>
      
                  <div class="col-sm-6 text-center">
                    <audio controls>
                      <source src="audio/algarr/ablation/new_2_ref.ogg" type="audio/ogg" />
                      <source src="audio/algarr/ablation/new_2_ref.mp3" type="audio/mpeg" />
                      <a href="audio/algarr/ablation/new_2_ref.mp3">target2_phrase_rule-based_search</a>
                    </audio>
                    <p class="h5">Search Reference</p>
                  </div>  
          </div>
      </div>
</section>
{% include scripts.html %}
{% include copyright_NYU.html %}
</body>
</html>
